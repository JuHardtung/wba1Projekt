<!DOCTYPE HTML>

<html>

<head>

    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
            font: 'Press Start 2P';
        }
        
        #menu,
        input {
            width: 100%;
            background: #c7c7c7;
            font-family: Verdana;
            font-size: 1em;
            line-height: 1.5;
            float: left;
        }
        
        #menu ul {
            float: left;
            width: 140px;
            list-style-type: none;
        }
        /*--definiert die Block&uuml;berschriften--*/
        
        #menu h3 {
            font-size: 1em;
            text-align: center;
            color: #fff;
            background: #787878;
        }
        /*--definiert die "Drop-Down-Links" im Normalzustand--*/
        
        #menu input {
            display: block;
            border: 1px solid #ccc;
            text-align: center;
            background: #787878;
            color: #fff;
            font-weight: bold;
        }
        /*--definiert die "Drop-Down-Links" im Hoverzustand--*/
        
        #menu input:hover {
            color: #787878;
            background: #bababa;
        }
        /*verhindert im Zusammenhang mit position absolute bei ul ul
*eine H&ouml;henvergr&ouml;&szlig;erung von #menu beim Hovern--
*/
        
        #menu li {
            position: relative;
        }
        /*--versteckt die "Drop-Down-Links", solange nicht gehovert wird--*/
        
        #menu ul ul {
            position: absolute;
            z-index: 2;
            display: none;
        }
        /*--l&auml;sst die Dropdown-Links beim Hovern erscheinen--*/
        
        #menu ul li:hover ul {
            display: block;
        }
    </style>
</head>

<body>
    <div id="menu">
        <ul>
            <li>
                <h3>Levelauswahl</h3>
                <ul>
                    <li>
                        <input type="button" id="buttonOne" value="Level 1" onclick="analyzeLevel(this.value), h = 0">
                    </li>
                    <li>
                        <input type="button" id="buttonTwo" value="Level 2" onclick="analyzeLevel(this.value), h = 0">
                    </li>
                    <li>
                        <input type="button" id="buttonRandom" value="Level Random" onclick="drawLevelRandom(),analyzeLevel(this.value), h = 0">
                    </li>
                </ul>
            </li>
        </ul>
        <ul>
            <li>
                <h3>Autoauswahl</h3>
                <ul>
                    <li>
                        <input type="button" id="batmanCar" value="Batman" onclick="batmanCar()">
                    </li>
                    <li>
                        <input type="button" id="redCar" value="Red Car" onclick="redCar()">
                    </li>
                    <li>
                        <input type="button" id="blueCar" value="Blue Car" onclick="blueCar()">
                    </li>
                </ul>
            </li>
        </ul>
        <ul>
            <li>
                <input type="button" id="buttonStart" value="Start Level" onclick="analyzeLevel(this.value)">
            </li>
        </ul>
        <ul>
            <li>
                <input type="button" id="buttonStop" value="Stop Level" onclick="analyzeLevel(this.value)">
            </li>
        </ul>
        <ul>
            <li>
                <input type="button" id="buttonCredits" value="Credits" onclick="analyzeLevel(this.value)">
            </li>
        </ul>
        <h2 id="highscore">Highscore: 0</h2>
    </div>

    <canvas id="myCanvas" tabindex="0"></canvas>

    <!-- TODO: Kollisionsabfrage-->
    <!-- TODO: Levelmovement-->
    <!-- TODO: Schwierigkeitsgrad-->

    <script type="text/javascript">
        var canvas = document.getElementById('myCanvas');
        var ctx = canvas.getContext('2d');

        var racer = new Image();
        racer.src = "Batmobile.png";

        var racerX = 0;
        var racerY = 20;
        var wallX = 0;
        var wallY = 100;
        var h = 0;
        var hOld = 0;
        var timer;
        var highscore = 0;
        var wallXnew = new Array();
        var wallYnew = new Array();
        var actLevel = '';

        var introMusic = new Audio('Intro.mp3');
        var muscicPlay = true;

        window.onload = function canvasRacerGame() {

            ctx.canvas.width = window.innerWidth - 20;
            ctx.canvas.height = window.innerHeight - 40;

            racerX = (canvas.width / 2) - 20;

            canvas.addEventListener('keydown', doKeyDown, true);

            //introMusic.play();

            setInterval(function () {
                rendering();
            }, (10));

        }

        function rendering() {
            clearCanvas();
            drawBackground();
            drawRacer();
            analyzeLevel(actLevel);
            drawLevel();
            collideTest();
        }

        function analyzeLevel(myLevel) {

            switch (myLevel) {

            case 'Level 1':
                actLevel = 'Level 1';
                drawLevelOne();
                break;

            case 'Level 2':
                actLevel = 'Level 2';
                drawLevelTwo();
                break;

            case 'Level Random':
                actLevel = 'Level Random';
                drawLevel();
                break;

            case 'Credits':
                actLevel = 'Credits';
                drawCredits();
                break;
            case 'Start Level':
                startLevel();
                break;

            case 'Stop Level':
                stopLevel();
                break;
            }
        }

        function drawLevelOne() {

            wallXnew.length = 0;
            wallYnew.length = 0;
            wallXnew[0] = 0;
            wallYnew[0] = 100;
            var i = 1;

            //30 walls straight
            for (i; i < 310; i++) {

                wallXnew[i] = 0;
                wallYnew[i] = wallYnew[i - 1] + 1;
            }
            //20 walls left
            for (i; i < 500; i++) {
                wallXnew[i] = wallXnew[i - 1] + 0.5;
                wallYnew[i] = wallYnew[i - 1] + 1;
            }
        }

        function drawLevelTwo() {

            wallXnew.length = 0;
            wallYnew.length = 0;
            wallXnew[0] = 0;
            wallYnew[0] = 100;
            var i = 1;

            //30 walls straight
            for (i; i < 310; i++) {

                wallXnew[i] = 0;
                wallYnew[i] = wallYnew[i - 1] + 1;
            }
            //20 walls left
            for (i; i < 510; i++) {

                wallXnew[i] = wallXnew[i - 1] + 0.5;
                wallYnew[i] = wallYnew[i - 1] + 1;
            }
            // 30 walls right
            for (i; i < 810; i++) {

                wallXnew[i] = wallXnew[i - 1] - 0.5;
                wallYnew[i] = wallYnew[i - 1] + 1;
            }

            //20 walls left
            for (i; i < 101; i++) {

                wallXnew[i] = wallXnew[i - 1] + 0.5;
                wallYnew[i] = wallYnew[i - 1] + 1;
            }
        }


        //FIXME random function
        function drawLevelRandom() {

            wallXnew.length = 0;
            wallYnew.length = 0;
            wallXnew[0] = 0;
            wallYnew[0] = 100;

            var i = 1;
            var iOld = 0;
            //30 walls straight
            for (i; i < 310; i++) {

                wallXnew[i] = 0;
                wallYnew[i] = wallYnew[i - 1] + 1;
                drawWall(wallXnew[i], wallYnew[i]);
            }
            //20 walls random

            for (var w = 0; w < 3; w++) {
                var xNEW = Math.floor((Math.random() * (3 - 1) + 1);


                    switch (xNEW) {

                    case 1:
                        break;
                    case 2:
                        break;
                    case 3:
                        break;
                    }

                    iOld = iOld + 100;
                    for (i; i < iOld; i++) {
                        wallXnew[i] = wallXnew[i - 1] + xNEW;
                        wallYnew[i] = wallYnew[i - 1] + 1;

                    }
                }
            }

            function drawBackground() {

                ctx.beginPath();
                ctx.rect((canvas.width - 500) / 2, 0, 500, canvas.height);
                ctx.fillStyle = 'lightgray';
                ctx.fill();
            }

            function drawLevel() {

                for (var i = 0; i < wallXnew.length; i++) {
                    drawWall(wallXnew[i], wallYnew[i]);
                }
            }

            //left and right wall 
            function drawWall(wallX, wallY) {

                ctx.beginPath();
                ctx.moveTo((canvas.width / 2) - 250, wallY + h);
                ctx.lineTo((canvas.width / 2) - 50 - wallX, wallY + h);
                ctx.strokeStyle = "black";
                ctx.lineWidth = "1";
                ctx.stroke();

                ctx.beginPath();
                ctx.moveTo(canvas.width / 2 + 250, wallY + h);
                ctx.lineTo(canvas.width / 2 + 50 - wallX, wallY + h);
                ctx.stroke();
            }


            function drawLevelFailed() {

                ctx.rect(50, 50, 300, 100);
                ctx.fillStyle = 'red';
                ctx.fill();

                ctx.font = "50px ArcadeClassic";
                ctx.fillStyle = "white";
                ctx.fillText("You failed!", 100, 100);
            }

            function drawCredits() {

                ctx.rect((canvas.width - 500) / 2, 0, 500, canvas.height);
                ctx.fillStyle = 'black';
                ctx.fill();

                ctx.font = "15px Press Start 2P";
                ctx.fillStyle = 'white';
                ctx.fillText("Programming:", (canvas.width - 475) / 2, canvas.height / 2 - 100);
                ctx.fillText("Julian Hardtung ", (canvas.width - 250) / 2, canvas.height / 2 + -75);

                ctx.fillText("Background Music:", (canvas.width - 475) / 2, canvas.height / 2 - 45);
                ctx.fillText("Erik Skiff-HHavok-intro", (canvas.width - 250) / 2, canvas.height / 2 - 15);
                ctx.font = "10px Press Start 2P";
                ctx.fillText("Ein Projekt im Rahmen des", (canvas.width - 475) / 2, canvas.height / 2 + 300);
                ctx.fillText("Web-basierte-Anwendungen Moduls der", (canvas.width - 475) / 2, canvas.height / 2 + 320);
                ctx.fillText("Technischen Hochschule Koeln Campus Gummersbach", (canvas.width - 475) / 2, canvas.height / 2 + 340);

            }

            function drawRacer() {
                ctx.drawImage(racer, racerX, racerY, 35, 70);
            }

            function clearCanvas() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }

            function levelMovement() {
                hOld = h - hOld;
                h -= 1;
            }

            function startLevel() {
                highscore = 0;
                h = 0;
                timer = window.setInterval(highscoreFunction, 1000);
                move = window.setInterval(levelMovement, 10);

                if (muscicPlay == false) {
                    introMusic.currentTime = 0.0;
                    introMusic.play();
                    muscicPlay == true;
                }
            }

            function highscoreFunction() {

                highscore = highscore + 1;
                document.getElementById("highscore").innerHTML = "Highscore: " + highscore;
            }

            function stopLevel() {

                window.clearInterval(timer);
                window.clearInterval(move);
                introMusic.pause();
                muscicPlay = false;
            }


            //FIXME collision test with moving walls
            function collideTest() {

                for (var i = 0; i <= wallYnew.length; i++) {

                    if ((wallYnew[i] + hOld) === 70) {
                        if (((canvas.width / 2) - 50 - wallX) >= (racerX)) {

                            drawLevelFailed();
                            //stopLevel();
                        } else if ((canvas.width / 2 + 50 - wallX) <= (racerX + 35)) {

                            drawLevelFailed();
                            //stopLevel();
                        }
                    }
                }
            }

            function batmanCar() {

                racer.src = "Batmobile.png";
            }

            function redCar() {

                racer.src = "Racer2.png";
            }

            function blueCar() {

                racer.src = "Racer.png";
            }

            //key pressed
            function doKeyDown(e) {

                //X-Axis movement
                if (e.keyCode == 37) {
                    racerX = racerX - 10;
                }

                if (e.keyCode == 39) {
                    racerX = racerX + 10;
                }

                //movement on y-axis is not needed            
                /*if (e.keyCode == 38) {
                    racerY = racerY - 10;
                }

                if (e.keyCode == 40) {
                    racerY = racerY + 10;
                }*/
            }
    </script>
</body>

</html>