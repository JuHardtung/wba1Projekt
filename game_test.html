<!DOCTYPE HTML>

<html>

<head>
    <style>
        body {
            margin: 0px;
            padding: 0px;
        }
    </style>
</head>

<body>

    <input type="button" id="buttonOne" value="Level 1" onclick="analyzelevel(.this.value)">
    <input type="button" id="buttonTwo" value="Level 2" onclick="analyzeLevel(this.value)">
    <input type="button" id="buttonRandom" value="Level Random" onclick="analyzeLevel(this.value)">
    <input type="button" id="buttonStart" value="Start Level" onclick="analyzeLevel(this.value)">
    <input type="button" id="buttonStop" value="Stop Level" onclick="analyzeLevel(this.value)">
    <input type="button" id="buttonClear" value="Clear Level" onclick="clearCanvas()">
    <input type="button" id="buttonBG" value="Draw Background" onclick="drawBackground()">




    <h1 id="demo"></h1>

    <h2 id="zaehler"></h2>
    <h2 id="waende"></h2>
    <h3 id="collision"></h3>
    <h3 id="movement"></h3>

    <canvas id="myCanvas" tabindex="0"></canvas>

    <!-- TODO: Highscore-->
    <!-- TODO: Kollisionsabfrage-->
    <!-- TODO: Levelmovement-->
    <!-- TODO: Schwierigkeitsgrad-->


    <script type="text/javascript">
        var canvas = document.getElementById('myCanvas');
        var ctx = canvas.getContext('2d');


        var racer = new Image();
        racer.src = "Racer.png";

        var racerX = 500;
        var racerY = 20;
        var hoehe = 100
        var h = 0;
        var y = 0;
        var timer;
        var highscore = 0;

        window.onload = function canvasRacerGame() {

                clearCanvas();
                bildschirm();
                drawLevelOne();

                ctx.drawImage(racer, 500, 20, 40, 80);

                canvas.addEventListener('keydown', doKeyDown, true);

            }
            //FIXME: dynamische canvas Größe
        function bildschirm() {
            ctx.canvas.width = window.innerWidth - 20;
            ctx.canvas.height = window.innerHeight - 40;
        }

        /*function showCoords(event) {

            var x = event.clientX;
            var y = event.clientY;
            var coords = "X coords: " + x + "Y coords: " + y;

            document.getElementById("demo").innerHTML = coords
        }*/


        //FIXME: doppelte Ränder
        function analyzeLevel(myLevel) {

            switch (myLevel) {

            case 'Level 1':
                drawLevelOne();
                break;

            case 'Level 2':
                drawLevelTwo();
                break;

            case 'Level Random':
                drawLevelRandom();
                break;

            case 'Start Level':
                startLevel();
                break;

            case 'Stop Level':
                stopLevel();
                break;

            }
        }

        //level_One Editor
        function drawLevelOne() {

            hoehe = 100;
            y = 0;

            clearCanvas();
            drawBackground();
            drawStraight();

            for (var i = 0; i < 1; i++) {
                drawLeft();
                drawRight();
            }
            drawRacer();
        }

        //level_Two Editor
        function drawLevelTwo() {

            hoehe = 100;
            y = 0;
            clearCanvas();
            drawBackground();
            drawStraight();

            for (var i = 0; i < 1; i++) {
                drawLeft();
                drawLeft();
                drawRight();
                drawLeft();
            }
            drawRacer();
        }


        //level_Two Editor
        function drawLevelRandom() {

            hoehe = 100;
            y = 0;
            var counter = 0;

            clearCanvas();
            drawBackground();
            drawStraight();


            for (var i = 1; i <= 4; i++) {

                drawRandomNew();
            }
            drawRacer();

        }


        function drawBackground() {

            ctx.beginPath();
            ctx.rect((canvas.width - 500) / 2, 0, 500, canvas.height);
            ctx.fillStyle = 'lightgray';
            ctx.fill();

            //ctx.strokeRect((canvas.width - 500) / 2, 0, 500, canvas.height);
            //ctx.lineWidth = 1;
            //ctx.stroke();
        }

        //level-pattern straight
        function drawStraight() {
            for (var i = 1; i < 20; i++) {

                hoehe = hoehe + 11;

                drawWall(y, h);
            }
        }

        //level-pattern to left
        function drawLeft() {
            for (var i = 1; i < 15; i++) {

                hoehe = hoehe + 11;
                y = y + 5;

                drawWall(y, h);
            }
        }

        //level-pattern to right
        function drawRight() {
            for (var i = 1; i < 15; i++) {

                hoehe = hoehe + 11;
                y = y - 5;

                drawWall(y, h);
            }
        }


        function drawRandom(counter) {

            var x = Math.floor((Math.random() * 3) + 1);

            switch (x) {

            case 1:

                drawStraight();
                break;

            case 2:

                if (counter <= -2) {
                    drawRight();
                    counter = counter + 1;
                    break;
                } else {
                    drawLeft();
                    counter = counter - 1;
                    break;
                }

            case 3:
                if (counter >= 2) {
                    drawLeft();
                    counter = counter - 1;
                    break;
                } else {
                    drawRight();
                    counter = counter + 1;
                    break;
                }
            }
            document.getElementById("zaehler").innerHTML = "Counter: " + counter;
            return counter;
        }


        function drawRandomNew(h) {

            var xNEW = Math.floor((Math.random() * 5) - 5);

            drawWall(xNEW, h);

            document.getElementById("waende").innerHTML = "X: " + xNEW + "Y: " + h;

        }

        //left and right wall 
        function drawWall(y, h) {

            ctx.beginPath();
            ctx.moveTo((canvas.width / 2) - 250, hoehe + h);
            ctx.lineTo((canvas.width / 2) - 50 - y, hoehe + h);
            ctx.strokeStyle = "black";
            ctx.lineWidth = "5";
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(canvas.width / 2 + 250, hoehe + h);
            ctx.lineTo(canvas.width / 2 + 50 - y, hoehe + h);
            ctx.strokeStyle = "black";
            ctx.stroke();
        }

        function drawRacer() {
            ctx.drawImage(racer, racerX, racerY, 40, 80);
        }

        function clearCanvas() {

            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        function levelMovement() {

            h -= 1;
            clearCanvas();
            drawBackground();
            drawRacer();
            drawLevelTwo();
            document.getElementById("movement").innerHTML = "Movement: " + h;
        }

        function startLevel() {
            highscore = 0;
            h = 0;
            timer = window.setInterval(highscoreFunction, 1000);
            move = window.setInterval(levelMovement, 5);
        }

        function highscoreFunction() {

            highscore = highscore + 1;
            document.getElementById("demo").innerHTML = "Highscore: " + highscore;
        }

        function stopLevel() {

            window.clearInterval(timer);
            window.clearInterval(move);
        }


        /* function collideTest() {

             // Collision detection. Get a clip from the screen.
             var clipWidth = 20;
             var clipDepth = 20;
             var clipLength = clipWidth * clipDepth;
             // alert(clipLength);
             var clipOffset = 5;
             var whatColor = ctx.getImageData(shipX + clipOffset, shipY + clipOffset, clipWidth, clipDepth);

             // Loop through the clip and see if you find red or blue. 
             for (var i = 0; i < clipLength * 4; i += 4) {
                 if (whatColor.data[i] == 255) {
                     alert("red");
                     break;
                 }
                 // Second element is green but we don't care. 
                 if (whatColor.data[i + 2] == 255) {
                     alert("blue");
                     break;
                 }
                 // Fourth element is alpha and we don't care. 
             }
         }*/



        //key pressed




        function doKeyDown(e) {

            //X-Axis movement
            if (e.keyCode == 37) {
                clearCanvas();
                racerX = racerX - 10;
                drawBackground();
                drawLevelTwo();
                ctx.drawImage(racer, racerX, racerY, 40, 80);
            }

            if (e.keyCode == 39) {
                clearCanvas();
                racerX = racerX + 10;
                drawBackground();
                drawLevelTwo();
                ctx.drawImage(racer, racerX, racerY, 40, 80);
            }


            //movement on y-axis is not nedded
            /*if (e.keyCode == 38) {
                clearCanvas();
                racerY = racerY - 10;
                drawBackground();
                drawLevelTwo();
                ctx.drawImage(racer, racerX, racerY, 40, 80);
            }

            if (e.keyCode == 40) {
                clearCanvas();
                racerY = racerY + 10;
                drawBackground();
                drawLevelTwo();
                ctx.drawImage(racer, racerX, racerY, 40, 80);
            }*/
        }
    </script>

</body>

</html>