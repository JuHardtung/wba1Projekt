<!DOCTYPE HTML>

<html>

<head>
    <style>
        body {
            margin: 0px;
            padding: 0px;
        }
    </style>
</head>

<body>

    <input type="button" id="buttonOne" value="Level 1" onclick="analyzeLevel(this.value), timer(), highscore = 0">
    <input type="button" id="buttonTwo" value="Level 2" onclick="analyzeLevel(this.value), timer(), highscore = 0">
    <input type="button" id="buttonRandom" value="Level Random" onclick="analyzeLevel(this.value), window.setInterval(timer(), 1000), highscore = 0">
    <input type="button" id="buttonStart" value="Start Level" onclick="analyzeLevel(this.value), window.setInterval(startLevel(), 1000)">

    <h1 id="demo"></h1>
    <h2 id="zaehler"></h2>


    <canvas id="myCanvas" tabindex="0"></canvas>

    <!-- TODO: Highscore-->
    <!-- TODO: Kollisionsabfrage-->
    <!-- TODO: Levelmovement-->
    <!-- TODO: Schwierigkeitsgrad-->


    <script type="text/javascript">
        var canvas = document.getElementById('myCanvas');
        var ctx = canvas.getContext('2d');


        var racer = new Image();
        racer.src = "Racer.png";

        var racerX = 500;
        var racerY = 20;
        highscore = 0;


        window.onload = function canvasRacerGame() {

                clearCanvas();
                bildschirm();
                drawBackground();
                drawLevelOne();

                ctx.drawImage(racer, 500, 20, 40, 80);

                canvas.addEventListener('keydown', doKeyDown, true);

            }
            //FIXME: dynamische canvas Größe
        function bildschirm() {
            ctx.canvas.width = window.innerWidth - 10;
            ctx.canvas.height = window.innerHeight - 40;
        }

        /*function showCoords(event) {

            var x = event.clientX;
            var y = event.clientY;
            var coords = "X coords: " + x + "Y coords: " + y;

            document.getElementById("demo").innerHTML = coords
        }*/


        //FIXME: doppelte Ränder
        function analyzeLevel(myLevel) {

            switch (myLevel) {

            case 'Level 1':

                drawLevelOne();
                break;

            case 'Level 2':

                drawLevelTwo();
                break;

            case 'Level Random':

                drawLevelRandom();
                break;

            case 'Start Level':

                startLevel();
                break;
            }
        }

        //level_One Editor
        function drawLevelOne() {

            h = 100;
            y = 0;

            clearCanvas();
            drawBackground();
            drawStraight();

            for (var i = 0; i < 1; i++) {
                drawLeft();
                drawRight();
            }
            ctx.drawImage(racer, canvas.width, 20, 40, 80);

        }

        //level_Two Editor
        function drawLevelTwo() {

            h = 100;
            y = 0;

            clearCanvas();
            drawBackground();
            drawStraight();

            for (var i = 0; i < 1; i++) {
                drawLeft();
                drawLeft();
                drawRight();
                drawLeft();
            }
            ctx.drawImage(racer, canvas.width, 20, 40, 80);

        }


        //level_Two Editor
        function drawLevelRandom() {

            var now = new Date();
            var second = now.getSeconds();
            h = 100;
            y = 0;
            var counter = 0;

            clearCanvas();
            drawBackground();
            drawStraight();


            for (var i = 0; i <= 3; i++) {

                drawRandom(counter);

            }

            ctx.drawImage(racer, canvas.width, 20, 40, 80);

        }


        function drawBackground() {

            ctx.beginPath();
            ctx.rect((canvas.width - 500) / 2, 0, 500, canvas.height);
            ctx.fillStyle = 'lightgray';
            ctx.fill();
            ctx.stroke();
        }

        function startLevel() {

            clearCanvas();
            h = h + 5;

        }

        //level-pattern straight
        function drawStraight() {
            for (var i = 1; i < 20; i++) {

                h = h + 11;

                drawWall(y, h);
            }
        }

        //level-pattern to left
        function drawLeft() {
            for (var i = 1; i < 15; i++) {

                h = h + 11;
                y = y + 5;

                drawWall(y, h);
            }
        }

        //level-pattern to right
        function drawRight() {
            for (var i = 1; i < 15; i++) {

                h = h + 11;
                y = y - 5;

                drawWall(y, h);
            }
        }


        function drawRandom(counter) {


            var x = Math.floor((Math.random() * 3) + 1);

            switch (x) {

            case 1:

                drawStraight();
                break;

            case 2:

                if (counter <= -2) {
                    drawRight();
                    counter = counter + 1;
                    break;
                } else {
                    drawLeft();
                    counter = counter - 1;
                    break;
                }
                break;
            case 3:

                if (counter >= 2) {
                    drawLeft();
                    counter = counter - 1;
                    break;
                } else {
                    drawRight();
                    counter = counter + 1;
                    break;
                }
            }


        }

        //left and right wall 
        function drawWall(y, h) {

            ctx.beginPath();
            ctx.moveTo(canvas.width / 2 - 250, h);
            ctx.lineTo(canvas.width / 2 - 50 - y, h);
            ctx.strokeStyle = "black";
            ctx.lineWidth = "5";
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(canvas.width / 2 + 250, h);
            ctx.lineTo(canvas.width / 2 + 50 - y, h);
            ctx.strokeStyle = "black";
            ctx.stroke();
        }

        function clearCanvas() {

            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        function timer() {

            highscore++;

            document.getElementById("demo").innerHTML = highscore
        }

        //key pressed
        //TODO: diagonale Steuerung
        function doKeyDown(e) {
            if (e.keyCode == 37) {

                clearCanvas();
                racerX = racerX - 5;
                drawBackground();
                drawLevelOne();
                ctx.drawImage(racer, racerX, racerY, 40, 80);
            }

            if (e.keyCode == 39) {

                clearCanvas();
                racerX = racerX + 5;
                drawBackground();
                drawLevelOne();
                ctx.drawImage(racer, racerX, racerY, 40, 80);
            }

            if (e.keyCode == 38) {

                clearCanvas();
                racerY = racerY - 5;
                drawBackground();
                drawLevelOne();
                ctx.drawImage(racer, racerX, racerY, 40, 80);
            }

            if (e.keyCode == 40) {

                clearCanvas();
                racerY = racerY + 5;
                drawBackground();
                drawLevelOne();
                ctx.drawImage(racer, racerX, racerY, 40, 80);
            }

            if (e.keyCode == 38 && e.keyCode == 37) {

                clearCanvas();
                racerY = racerY + 5;
                racerX = racerX - 5;
                drawBackground();
                drawLevelOne();
                ctx.drawImage(racer, racerX, racerY, 40, 80);
            }
        }
    </script>

</body>

</html>